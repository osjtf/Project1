<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Interest Quiz — NextStep Navigator</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"/>
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>

  <style>
    :root{
      --brand:#5b7cff; --brand2:#0ea5e9; --ink:#0f172a; --muted:#667085; --ring:#e5e7eb; --card:#fff; --surface:#f8fafc;
    }
    body{background:var(--surface); color:var(--ink)}
    a{text-decoration:none}

    .navbar{background:#fff}
    .brand-dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--brand),var(--brand2));box-shadow:0 0 0 3px rgba(14,165,233,.15)}

    .page-head{background:#fff;border-bottom:1px solid #eef2f7}
    .lead-muted{color:var(--muted)}

    .panel{background:#fff;border:1px solid var(--ring);border-radius:18px}
    .feature-card{border:1px solid var(--ring);background:var(--card);border-radius:16px;transition:all .25s ease}
    .feature-card:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(16,24,40,.07);border-color:rgba(91,124,255,.4)}

    .muted{color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:.5rem;padding:.25rem .6rem;border:1px solid var(--ring);border-radius:999px;background:#fff;font-size:.8rem}

    .progress{height:10px;border-radius:999px}
    .choice{border:1px solid var(--ring);border-radius:12px;padding:.75rem 1rem;cursor:pointer;transition:.2s}
    .choice:hover{border-color:#c7d2fe;background:#f8fafc}
    .choice input{display:none}
    .choice.active{border-color:#93c5fd;background:#f0f9ff}
    .hidden{display:none !important}
    .bookmark-active{color:#e11d48 !important}
    .icon-pill{width:38px;height:38px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;background:#eef2ff;color:#3b82f6}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar navbar-expand-lg border-bottom sticky-top">
    <div class="container py-2">
      <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="index.html">
        <span class="brand-dot"></span> NextStep <span class="text-primary">Navigator</span>
      </a>
      <div class="ms-auto d-flex align-items-center gap-3">
        <span class="small text-muted" id="helloUser"></span>
        <a class="btn btn-outline-secondary btn-sm" href="index.html"><i class="bi bi-house me-1"></i> Home</a>
      </div>
    </div>
  </nav>

  <!-- HEADER -->
  <header class="page-head py-4">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">Interest Quiz</li>
        </ol>
      </nav>
      <div class="d-flex flex-column flex-md-row align-items-md-end align-items-start justify-content-between gap-3">
        <div>
          <h1 class="mb-1">Interest-Based Quiz</h1>
          <p class="lead lead-muted mb-0">Answer a few questions to discover best-fit streams and careers. No data is stored.</p>
        </div>
        <span class="pill"><i class="bi bi-shield-check"></i> Session-only • No login</span>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="py-4">
    <div class="container">
      <div class="row g-4">
        <!-- Left: Quiz / Results -->
        <section class="col-lg-8">
          <!-- Setup panel -->
          <div id="setup" class="panel p-3 p-md-4">
            <h5 class="mb-3">Choose your interest focus</h5>
            <div class="row g-2">
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="technology"><i class="bi bi-cpu me-1"></i> Technology</button>
              </div>
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="healthcare"><i class="bi bi-heart-pulse me-1"></i> Healthcare</button>
              </div>
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="business"><i class="bi bi-briefcase me-1"></i> Business</button>
              </div>
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="design"><i class="bi bi-palette2 me-1"></i> Design</button>
              </div>
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="engineering"><i class="bi bi-gear-wide-connected me-1"></i> Engineering</button>
              </div>
            </div>
            <hr/>
            <div class="small text-muted">Tip: Pick the category closest to your interests. You can always retake.</div>
          </div>

          <!-- Quiz panel -->
          <div id="quizPanel" class="panel p-3 p-md-4 hidden" aria-live="polite">
            <div class="d-flex align-items-center justify-content-between">
              <div class="small text-muted"><span id="activeProfile"></span></div>
              <div class="small text-muted">Q <span id="qIndex">1</span>/<span id="qTotal">12</span></div>
            </div>
            <div class="progress my-3" role="progressbar" aria-label="Progress">
              <div class="progress-bar bg-primary" id="progressBar" style="width: 0%"></div>
            </div>

            <h5 id="qText" class="mb-3">Question text…</h5>
            <div id="choices" class="d-grid gap-2"></div>

            <div class="d-flex align-items-center justify-content-between mt-3">
              <button class="btn btn-outline-secondary" id="btnPrev" disabled><i class="bi bi-arrow-left"></i> Previous</button>
              <div class="d-flex gap-2">
                <button class="btn btn-outline-primary" id="btnReview" disabled><i class="bi bi-list-check me-1"></i> Review</button>
                <button class="btn btn-primary" id="btnNext">Next <i class="bi bi-arrow-right"></i></button>
              </div>
            </div>

            <div id="reviewBlock" class="mt-3 hidden">
              <hr/>
              <h6 class="mb-2">Your answers</h6>
              <ol id="reviewList" class="small mb-0"></ol>
            </div>
          </div>

          <!-- Results panel -->
          <div id="results" class="panel p-3 p-md-4 hidden">
            <div class="d-flex align-items-center justify-content-between">
              <h4 class="mb-0">Your Recommendations</h4>
              <span class="pill"><i class="bi bi-stars"></i> Personalized</span>
            </div>
            <p class="muted mt-2 mb-3">Based on your responses, these streams and careers fit you best.</p>

            <h6 class="mt-2">Top Streams</h6>
            <div id="streamBadges" class="d-flex flex-wrap gap-2 mb-3"></div>

            <h6>Suggested Careers</h6>
            <div id="careerGrid" class="row g-3"></div>

            <hr/>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-primary" id="btnSave"><i class="bi bi-bookmark-heart me-1"></i> Save Results</button>
              <button class="btn btn-outline-primary" id="btnExport"><i class="bi bi-arrow-down-square me-1"></i> Export</button>
              <button class="btn btn-outline-secondary" id="btnRetake"><i class="bi bi-arrow-counterclockwise me-1"></i> Retake</button>
              <a class="btn btn-outline-dark" href="careers.html"><i class="bi bi-briefcase me-1"></i> Open Career Bank</a>
            </div>
          </div>
        </section>

        <!-- Right: Helper panels -->
        <aside class="col-lg-4">
          <div class="panel p-3">
            <h6 class="mb-2">How it works</h6>
            <p class="small mb-2">Each option adds points to certain **streams** (e.g., Technology, Business, Design). At the end, we rank streams and map them to careers.</p>
            <ul class="small mb-0">
              <li>No sign-in, no storage — unless you click <em>Save</em>.</li>
              <li>You can navigate back and review answers anytime.</li>
              <li>Suggestions are aligned to your Career Bank dataset.</li>
            </ul>
          </div>

          <div class="panel p-3 mt-3">
            <h6>Recently Viewed</h6>
            <ul id="recentList" class="list-unstyled small mb-0">
              <li class="text-muted">Nothing yet.</li>
            </ul>
          </div>

          <div class="panel p-3 mt-3">
            <h6>Your Bookmarks</h6>
            <ul id="bookmarkList" class="list-unstyled small mb-2">
              <li class="text-muted">No bookmarks yet.</li>
            </ul>
            <div class="d-flex gap-2">
              <button class="btn btn-outline-primary btn-sm" id="exportBookmarks"><i class="bi bi-arrow-down-square me-1"></i> Export</button>
              <button class="btn btn-outline-danger btn-sm" id="clearBookmarks"><i class="bi bi-trash3 me-1"></i> Clear</button>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="py-4 border-top bg-white">
    <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between gap-2">
      <div class="small text-muted">© <span id="year"></span> NextStep Navigator • Interest Quiz</div>
      <div class="small"><a href="about.html" class="me-3">About</a><a href="contact.html">Contact</a></div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script>
    // ========= Shared keys with other pages =========
    const RECENT_KEY = 'nsn_recent';
    const BM_KEY = 'nsn_bookmarks';

    // ========= Personalization =========
    const $ = (s, root=document)=>root.querySelector(s);
    const $$ = (s, root=document)=>[...root.querySelectorAll(s)];
    function paintHeaderProfile(){
      const nm = sessionStorage.getItem('nsn_name') || '';
      const tp = sessionStorage.getItem('nsn_type') || '';
      $('#helloUser').textContent = (nm || tp) ? `Hi ${nm ? nm : ''}${nm && tp ? ' • ' : ''}${tp ? tp[0].toUpperCase()+tp.slice(1) : ''}` : '';
      $('#activeProfile').textContent = tp ? `Tailored for: ${tp}` : '';
    }

    // ========= Demo Careers map (matches careers.html IDs) =========
    const CAREER_MAP = {
      technology: [
        {id:'sw-eng', title:'Software Engineer', icon:'bi-code-slash', href:'careers.html?c=sw-eng'},
        {id:'data-analyst', title:'Data Analyst', icon:'bi-bar-chart-line', href:'careers.html?c=data-analyst'},
        {id:'cyber', title:'Cybersecurity Analyst', icon:'bi-shield-lock', href:'careers.html?c=cyber'}
      ],
      business: [
        {id:'mktg', title:'Digital Marketer', icon:'bi-megaphone', href:'careers.html?c=mktg'},
        {id:'acct', title:'Accountant', icon:'bi-calculator', href:'careers.html?c=acct'}
      ],
      design: [
        {id:'ui-ux', title:'UI/UX Designer', icon:'bi-palette2', href:'careers.html?c=ui-ux'}
      ],
      healthcare: [
        {id:'nurse', title:'Registered Nurse', icon:'bi-heart-pulse', href:'careers.html?c=nurse'},
        {id:'physician', title:'Physician (General)', icon:'bi-clipboard2-pulse', href:'careers.html?c=physician'}
      ],
      engineering: [
        {id:'civil', title:'Civil Engineer', icon:'bi-building', href:'careers.html?c=civil'},
        {id:'mech', title:'Mechanical Engineer', icon:'bi-cpu', href:'careers.html?c=mech'}
      ]
    };

    // ========= Quiz dataset (inline). Move to data/quiz.json if desired. =========
    // Each answer pushes scores to one or more streams with weights.
    const QUIZ_DATA = {
      technology: {
        total: 12,
        questions: [
          { q: "Which activity sounds most exciting?",
            choices: [
              {t:"Building a mobile app prototype", s:{technology:3, design:1}},
              {t:"Planning a marketing campaign", s:{business:2}},
              {t:"Designing a poster for an event", s:{design:2}},
              {t:"Assisting in a clinic", s:{healthcare:2}}
            ]},
          { q: "Pick a course you’d enjoy the most:",
            choices: [
              {t:"Algorithms & Problem Solving", s:{technology:3}},
              {t:"Financial Accounting", s:{business:2}},
              {t:"Human Anatomy", s:{healthcare:2}},
              {t:"Product Design Studio", s:{design:2}}
            ]},
          { q: "In a team, you naturally become the…",
            choices: [
              {t:"Coder / Troubleshooter", s:{technology:3}},
              {t:"Organizer / Presenter", s:{business:2}},
              {t:"Visualizer / Prototyper", s:{design:2}},
              {t:"Support / Carer", s:{healthcare:2}}
            ]},
          { q: "Which challenge sounds fun?",
            choices: [
              {t:"Automate a boring task", s:{technology:3}},
              {t:"Grow social media conversions", s:{business:2}},
              {t:"Redesign a confusing form", s:{design:2}},
              {t:"Simplify patient instructions", s:{healthcare:2}}
            ]},
          { q: "Choose a tool to master:",
            choices: [
              {t:"JavaScript/Python", s:{technology:3}},
              {t:"Excel/Power BI", s:{business:2, technology:1}},
              {t:"Figma", s:{design:3}},
              {t:"EMR System", s:{healthcare:3}}
            ]},
          { q: "Preferred work environment:",
            choices: [
              {t:"Product/Tech company", s:{technology:3}},
              {t:"Agency/Client projects", s:{business:2, design:1}},
              {t:"Hospital/Clinic", s:{healthcare:3}},
              {t:"Engineering firm", s:{engineering:3}}
            ]},
          { q: "What motivates you most?",
            choices: [
              {t:"Solving complex problems", s:{technology:3, engineering:1}},
              {t:"Helping people directly", s:{healthcare:3}},
              {t:"Making things look & feel better", s:{design:3}},
              {t:"Optimizing business outcomes", s:{business:3}}
            ]},
          { q: "Pick a mini-project:",
            choices: [
              {t:"Build a chatbot", s:{technology:3}},
              {t:"Design brand identity", s:{design:3}},
              {t:"Budget forecasting", s:{business:3}},
              {t:"Patient education leaflet", s:{healthcare:3}}
            ]},
          { q: "Which article would you read first?",
            choices: [
              {t:"‘Intro to APIs’", s:{technology:3}},
              {t:"‘Market Segmentation 101’", s:{business:3}},
              {t:"‘Principles of Ergonomics’", s:{engineering:3}},
              {t:"‘Digital Therapeutics’", s:{healthcare:3}}
            ]},
          { q: "Your strength is:",
            choices: [
              {t:"Logic & debugging", s:{technology:3}},
              {t:"Communication & pitching", s:{business:3}},
              {t:"Empathy & patience", s:{healthcare:3}},
              {t:"Sketching & prototyping", s:{design:3}}
            ]},
          { q: "Pick a mentor session:",
            choices: [
              {t:"Cloud careers roadmapping", s:{technology:3}},
              {t:"CV & interview strategy", s:{business:2}},
              {t:"Clinical pathways", s:{healthcare:3}},
              {t:"Design critique", s:{design:3}}
            ]},
          { q: "Which club would you join?",
            choices: [
              {t:"Coding club", s:{technology:3}},
              {t:"Entrepreneurship club", s:{business:3}},
              {t:"Makers/Robotics", s:{engineering:3, technology:1}},
              {t:"Art & Design club", s:{design:3}}
            ]}
        ]
      },
      healthcare: { /* same structure, slightly different flavoring by category */ },
      business:   { /* For brevity, we reuse the same core questions */ },
      design:     { /* Reuse */ },
      engineering:{ /* Reuse with some extra engineering boosts */ }
    };

    // Reuse baseline set for categories other than technology (to keep file compact)
    const base = JSON.parse(JSON.stringify(QUIZ_DATA.technology));
    QUIZ_DATA.healthcare = base;
    QUIZ_DATA.business = base;
    QUIZ_DATA.design = base;
    QUIZ_DATA.engineering = base;

    // ========= State =========
    const state = {
      interest:null,
      idx:0,
      answers:[], // stores choice index per question
      scores:{technology:0,business:0,design:0,healthcare:0,engineering:0},
    };

    // ========= Recently viewed & bookmarks =========
    function pushRecent(label, href='#'){
      const arr = JSON.parse(localStorage.getItem(RECENT_KEY) || '[]');
      const filtered = arr.filter(x=>x.label!==label);
      filtered.unshift({label, href, ts: Date.now()});
      localStorage.setItem(RECENT_KEY, JSON.stringify(filtered.slice(0,8)));
      paintRecent();
    }
    function paintRecent(){
      const el = $('#recentList');
      const arr = JSON.parse(localStorage.getItem(RECENT_KEY) || '[]');
      el.innerHTML = arr.length ? arr.map(x=>`<li>${x.label}</li>`).join('') : '<li class="text-muted">Nothing yet.</li>';
    }

    function getBookmarks(){ try { return JSON.parse(localStorage.getItem(BM_KEY) || '[]'); } catch { return []; } }
    function paintBookmarks(){
      const el = $('#bookmarkList');
      const list = getBookmarks();
      el.innerHTML = list.length ? list.map(x=>`<li><i class="bi bi-heart text-danger me-1"></i>${x.label}</li>`).join('') : '<li class="text-muted">No bookmarks yet.</li>';
    }
    function exportBookmarks(){
      const list = getBookmarks(); if(!list.length){ alert('No bookmarks to export.'); return; }
      const lines = list.map((x,i)=> `${i+1}. ${x.label}`);
      const blob = new Blob([lines.join('\n')], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'Bookmarks.txt'; a.click(); URL.revokeObjectURL(url);
    }
    function clearBookmarks(){ localStorage.removeItem(BM_KEY); paintBookmarks(); }

    // ========= Quiz Flow =========
    function startQuiz(interest){
      state.interest = interest;
      state.idx = 0;
      state.answers = Array(QUIZ_DATA[interest].total).fill(null);
      state.scores = {technology:0,business:0,design:0,healthcare:0,engineering:0};

      $('#setup').classList.add('hidden');
      $('#quizPanel').classList.remove('hidden');
      $('#results').classList.add('hidden');
      $('#qTotal').textContent = QUIZ_DATA[interest].total;
      $('#activeProfile').textContent = `Interest focus: ${interest[0].toUpperCase()+interest.slice(1)}`;
      renderQuestion();
      pushRecent('Started Interest Quiz');
    }

    function renderQuestion(){
      const pack = QUIZ_DATA[state.interest];
      const q = pack.questions[state.idx];
      $('#qIndex').textContent = state.idx + 1;
      $('#qText').textContent = q.q;

      // progress
      const pct = Math.round((state.idx) / pack.total * 100);
      $('#progressBar').style.width = pct + '%';

      // choices
      const wrap = $('#choices'); wrap.innerHTML = '';
      q.choices.forEach((c, i)=>{
        const d = document.createElement('label'); d.className = 'choice';
        if(state.answers[state.idx] === i) d.classList.add('active');
        d.innerHTML = `<input type="radio" name="choice" value="${i}"> ${c.t}`;
        d.addEventListener('click', ()=>{
          state.answers[state.idx] = i;
          // toggle active class visually
          $$('.choice').forEach(x=>x.classList.remove('active'));
          d.classList.add('active');
          $('#btnReview').disabled = !state.answers.some(a=>a!==null);
        });
        wrap.appendChild(d);
      });

      // nav buttons
      $('#btnPrev').disabled = state.idx === 0;
      $('#btnNext').textContent = (state.idx === pack.total - 1) ? 'Finish' : 'Next';
    }

    function applyScores(){
      // reset
      state.scores = {technology:0,business:0,design:0,healthcare:0,engineering:0};
      const pack = QUIZ_DATA[state.interest];
      state.answers.forEach((ans, i)=>{
        if(ans===null) return;
        const weights = pack.questions[i].choices[ans].s;
        for(const k in weights) state.scores[k] += weights[k];
      });
    }

    function toRanked(obj){
      return Object.entries(obj).sort((a,b)=> b[1]-a[1]).map(([k,v])=>({stream:k,score:v}));
    }

    function showResults(){
      applyScores();
      const ranked = toRanked(state.scores).filter(x=>x.score>0);
      $('#quizPanel').classList.add('hidden');
      $('#results').classList.remove('hidden');

      // Streams
      const sb = $('#streamBadges'); sb.innerHTML = ranked.length
        ? ranked.slice(0,3).map(x=>`<span class="badge text-bg-primary">${x.stream} • ${x.score}</span>`).join(' ')
        : '<span class="text-muted small">No signals yet — try retaking.</span>';

      // Careers (combine top 2–3 streams)
      const topStreams = ranked.slice(0,3).map(x=>x.stream);
      const picks = [];
      topStreams.forEach(s=>{
        (CAREER_MAP[s] || []).forEach(c=>picks.push({...c, stream:s}));
      });
      // de-dupe by id; take up to 6
      const seen = new Set(); const unique = [];
      for(const c of picks){ if(seen.has(c.id)) continue; seen.add(c.id); unique.push(c); if(unique.length>=6) break; }

      const grid = $('#careerGrid'); grid.innerHTML = unique.length ? unique.map(c=>careerCard(c)).join('') :
        '<div class="col-12"><div class="alert alert-warning mb-0">No career suggestions found. Try another interest.</div></div>';

      bindCareerActions();
      pushRecent('Viewed Quiz Results');
    }

    function careerCard(c){
      const bmActive = isBookmarked(c.id) ? 'bookmark-active' : '';
      return `
        <div class="col-12 col-md-6">
          <div class="feature-card p-3 h-100 d-flex align-items-start justify-content-between">
            <div class="d-flex align-items-start gap-3">
              <div class="icon-pill"><i class="bi ${c.icon}"></i></div>
              <div>
                <div class="small text-uppercase text-muted">${c.stream}</div>
                <h6 class="mb-1">${c.title}</h6>
                <a class="small" href="${c.href}">Open in Career Bank</a>
              </div>
            </div>
            <button class="btn btn-light btn-sm border-0 ${bmActive}" title="Bookmark" data-bm="${c.id}" data-label="${c.title}">
              <i class="bi bi-heart-fill"></i>
            </button>
          </div>
        </div>
      `;
    }

    function bindCareerActions(){
      $$('[data-bm]').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          e.preventDefault();
          const id = btn.getAttribute('data-bm');
          const label = btn.getAttribute('data-label');
          toggleBookmark({id, label});
          $$(`[data-bm="${id}"]`).forEach(b=>b.classList.toggle('bookmark-active'));
        });
      });
    }

    // ========= Review =========
    function paintReview(){
      const pack = QUIZ_DATA[state.interest];
      const list = $('#reviewList'); list.innerHTML = '';
      state.answers.forEach((ans,i)=>{
        const li = document.createElement('li');
        const ansText = (ans!==null) ? pack.questions[i].choices[ans].t : '(no answer)';
        li.textContent = `Q${i+1}: ${ansText}`;
        li.className = 'mb-1';
        li.style.cursor='pointer';
        li.addEventListener('click', ()=>{
          state.idx = i; $('#reviewBlock').classList.add('hidden'); renderQuestion();
        });
        list.appendChild(li);
      });
    }

    // ========= Bookmarks helpers for this page =========
    function isBookmarked(id){ return getBookmarks().some(x=>x.id===id); }
    function toggleBookmark(entry){
      const list = getBookmarks();
      const idx = list.findIndex(x=>x.id===entry.id);
      if(idx>=0) list.splice(idx,1);
      else list.unshift({id:entry.id, href:entry.href||'#', label:entry.label});
      localStorage.setItem(BM_KEY, JSON.stringify(list.slice(0,100)));
      paintBookmarks();
    }

    // ========= Export results =========
    function exportResults(){
      const lines = [];
      lines.push('NextStep Navigator — Interest Quiz Results');
      lines.push(`Focus: ${state.interest}`);
      lines.push('');
      const ranked = toRanked(state.scores);
      lines.push('Streams:');
      ranked.forEach((r,i)=> lines.push(`${i+1}. ${r.stream}: ${r.score}`));
      lines.push('');
      lines.push('Answers:');
      const pack = QUIZ_DATA[state.interest];
      state.answers.forEach((ans,i)=>{
        const txt = ans===null ? '(no answer)' : pack.questions[i].choices[ans].t;
        lines.push(`Q${i+1}. ${pack.questions[i].q}`);
        lines.push(`   → ${txt}`);
      });
      const blob = new Blob([lines.join('\n')], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'Interest_Quiz_Results.txt'; a.click();
      URL.revokeObjectURL(url);
    }

    // ========= Wire UI =========
    function wire(){
      // Setup buttons
      $$('[data-interest]').forEach(btn=>{
        btn.addEventListener('click', ()=> startQuiz(btn.getAttribute('data-interest')));
      });

      // Nav
      $('#btnPrev').addEventListener('click', ()=>{
        if(state.idx>0){ state.idx--; renderQuestion(); }
      });
      $('#btnNext').addEventListener('click', ()=>{
        const pack = QUIZ_DATA[state.interest];
        if(state.idx < pack.total - 1){
          // Require an answer to proceed
          if(state.answers[state.idx] === null){
            alert('Please select an answer to continue.');
            return;
          }
          state.idx++; renderQuestion();
        } else {
          // Finish
          if(state.answers[state.idx] === null){
            alert('Please select an answer to finish.');
            return;
          }
          showResults();
        }
      });

      // Review
      $('#btnReview').addEventListener('click', ()=>{
        paintReview();
        $('#reviewBlock').classList.toggle('hidden');
      });

      // Results actions
      $('#btnSave').addEventListener('click', ()=>{
        // Save top recommended careers as bookmarks
        $$('[data-bm]').forEach(btn=>{
          toggleBookmark({id:btn.getAttribute('data-bm'), label:btn.getAttribute('data-label')});
          btn.classList.add('bookmark-active');
        });
        alert('Saved your recommended careers to Bookmarks.');
      });
      $('#btnExport').addEventListener('click', exportResults);
      $('#btnRetake').addEventListener('click', ()=>{
        $('#results').classList.add('hidden');
        $('#setup').classList.remove('hidden');
        window.scrollTo({top:0, behavior:'smooth'});
      });

      // Sidebar bookmarks
      $('#exportBookmarks').addEventListener('click', exportBookmarks);
      $('#clearBookmarks').addEventListener('click', clearBookmarks);
    }

    function init(){
      $('#year').textContent = new Date().getFullYear();
      paintHeaderProfile();
      paintRecent();
      paintBookmarks();
      wire();

      // If query param mode=ugpg / pro (for deep links from home), preselect a focus
      const params = new URLSearchParams(location.search);
      const mode = params.get('mode');
      const map = { ugpg:'technology', pro:'business' };
      if(map[mode]) startQuiz(map[mode]);
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
