<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Interest Quiz — NextStep Navigator</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"/>
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>

  <style>
    :root{
      --brand:#5b7cff; --brand2:#0ea5e9; --ink:#0f172a; --muted:#667085; --ring:#e5e7eb; --card:#fff; --surface:#f8fafc;
    }
    body{background:var(--surface); color:var(--ink)}
    a{text-decoration:none}

    .navbar{background:#fff}
    .brand-dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--brand),var(--brand2));box-shadow:0 0 0 3px rgba(14,165,233,.15)}

    .page-head{background:#fff;border-bottom:1px solid #eef2f7}
    .lead-muted{color:var(--muted)}

    .panel{background:#fff;border:1px solid var(--ring);border-radius:18px}
    .feature-card{border:1px solid var(--ring);background:var(--card);border-radius:16px;transition:all .25s ease}
    .feature-card:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(16,24,40,.07);border-color:rgba(91,124,255,.4)}

    .muted{color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:.5rem;padding:.25rem .6rem;border:1px solid var(--ring);border-radius:999px;background:#fff;font-size:.8rem}

    .progress{height:10px;border-radius:999px}
    .choice{border:1px solid var(--ring);border-radius:12px;padding:.75rem 1rem;cursor:pointer;transition:.2s}
    .choice:hover{border-color:#c7d2fe;background:#f8fafc}
    .choice input{display:none}
    .choice.active{border-color:#93c5fd;background:#f0f9ff}
    .hidden{display:none !important}
    .bookmark-active{color:#e11d48 !important}
    .icon-pill{width:38px;height:38px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;background:#eef2ff;color:#3b82f6}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar navbar-expand-lg border-bottom sticky-top">
    <div class="container py-2">
      <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="index.html">
        <span class="brand-dot"></span> NextStep <span class="text-primary">Navigator</span>
      </a>
      <div class="ms-auto d-flex align-items-center gap-3">
        <span class="small text-muted" id="helloUser"></span>
        <a class="btn btn-outline-secondary btn-sm" href="index.html"><i class="bi bi-house me-1"></i> Home</a>
      </div>
    </div>
  </nav>

  <!-- HEADER -->
  <header class="page-head py-4">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">Interest Quiz</li>
        </ol>
      </nav>
      <div class="d-flex flex-column flex-md-row align-items-md-end align-items-start justify-content-between gap-3">
        <div>
          <h1 class="mb-1">Interest-Based Quiz</h1>
          <p class="lead lead-muted mb-0">Answer a few questions to discover best-fit streams and careers. No data is stored.</p>
        </div>
        <span class="pill"><i class="bi bi-shield-check"></i> Session-only • No login</span>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="py-4">
    <div class="container">
      <div class="row g-4">
        <!-- Left: Quiz / Results -->
        <section class="col-lg-8">
          <!-- Setup panel -->
          <div id="setup" class="panel p-3 p-md-4">
            <h5 class="mb-3">Choose your interest focus</h5>
            <div class="row g-2">
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="technology"><i class="bi bi-cpu me-1"></i> Technology</button>
              </div>
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="healthcare"><i class="bi bi-heart-pulse me-1"></i> Healthcare</button>
              </div>
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="business"><i class="bi bi-briefcase me-1"></i> Business</button>
              </div>
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="design"><i class="bi bi-palette2 me-1"></i> Design</button>
              </div>
              <div class="col-sm-6 col-md-4">
                <button class="btn btn-outline-primary w-100" data-interest="engineering"><i class="bi bi-gear-wide-connected me-1"></i> Engineering</button>
              </div>
            </div>
            <hr/>
            <div class="small text-muted">Tip: Pick the category closest to your interests. You can always retake.</div>
          </div>

          <!-- Quiz panel -->
          <div id="quizPanel" class="panel p-3 p-md-4 hidden" aria-live="polite">
            <div class="d-flex align-items-center justify-content-between">
              <div class="small text-muted"><span id="activeProfile"></span></div>
              <div class="small text-muted">Q <span id="qIndex">1</span>/<span id="qTotal">12</span></div>
            </div>
            <div class="progress my-3" role="progressbar" aria-label="Progress">
              <div class="progress-bar bg-primary" id="progressBar" style="width: 0%"></div>
            </div>

            <h5 id="qText" class="mb-3">Question text…</h5>
            <div id="choices" class="d-grid gap-2"></div>

            <div class="d-flex align-items-center justify-content-between mt-3">
              <button class="btn btn-outline-secondary" id="btnPrev" disabled><i class="bi bi-arrow-left"></i> Previous</button>
              <div class="d-flex gap-2">
                <button class="btn btn-outline-primary" id="btnReview" disabled><i class="bi bi-list-check me-1"></i> Review</button>
                <button class="btn btn-primary" id="btnNext">Next <i class="bi bi-arrow-right"></i></button>
              </div>
            </div>

            <div id="reviewBlock" class="mt-3 hidden">
              <hr/>
              <h6 class="mb-2">Your answers</h6>
              <ol id="reviewList" class="small mb-0"></ol>
            </div>
          </div>

          <!-- Results panel -->
          <div id="results" class="panel p-3 p-md-4 hidden">
            <div class="d-flex align-items-center justify-content-between">
              <h4 class="mb-0">Your Recommendations</h4>
              <span class="pill"><i class="bi bi-stars"></i> Personalized</span>
            </div>
            <p class="muted mt-2 mb-3">Based on your responses, these streams and careers fit you best.</p>

            <h6 class="mt-2">Top Streams</h6>
            <div id="streamBadges" class="d-flex flex-wrap gap-2 mb-3"></div>

            <h6>Suggested Careers</h6>
            <div id="careerGrid" class="row g-3"></div>

            <hr/>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-primary" id="btnSave"><i class="bi bi-bookmark-heart me-1"></i> Save Results</button>
              <button class="btn btn-outline-primary" id="btnExport"><i class="bi bi-arrow-down-square me-1"></i> Export</button>
              <button class="btn btn-outline-secondary" id="btnRetake"><i class="bi bi-arrow-counterclockwise me-1"></i> Retake</button>
              <a class="btn btn-outline-dark" href="careers.html"><i class="bi bi-briefcase me-1"></i> Open Career Bank</a>
            </div>
          </div>
        </section>

        <!-- Right: Helper panels -->
        <aside class="col-lg-4">
          <div class="panel p-3">
            <h6 class="mb-2">How it works</h6>
            <p class="small mb-2">Each option adds points to certain **streams** (e.g., Technology, Business, Design). At the end, we rank streams and map them to careers.</p>
            <ul class="small mb-0">
              <li>No sign-in, no storage — unless you click <em>Save</em>.</li>
              <li>You can navigate back and review answers anytime.</li>
              <li>Suggestions are aligned to your Career Bank dataset.</li>
            </ul>
          </div>

          <div class="panel p-3 mt-3">
            <h6>Recently Viewed</h6>
            <ul id="recentList" class="list-unstyled small mb-0">
              <li class="text-muted">Nothing yet.</li>
            </ul>
          </div>

          <div class="panel p-3 mt-3">
            <h6>Your Bookmarks</h6>
            <ul id="bookmarkList" class="list-unstyled small mb-2">
              <li class="text-muted">No bookmarks yet.</li>
            </ul>
            <div class="d-flex gap-2">
              <button class="btn btn-outline-primary btn-sm" id="exportBookmarks"><i class="bi bi-arrow-down-square me-1"></i> Export</button>
              <button class="btn btn-outline-danger btn-sm" id="clearBookmarks"><i class="bi bi-trash3 me-1"></i> Clear</button>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="py-4 border-top bg-white">
    <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between gap-2">
      <div class="small text-muted">© <span id="year"></span> NextStep Navigator • Interest Quiz</div>
      <div class="small"><a href="about.html" class="me-3">About</a><a href="contact.html">Contact</a></div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script>
  /**********************
 * NextStep Navigator — Interest Quiz
 * JS: JSON-driven (careers.json + quiz.json)
 **********************/

/* ---------- Shared storage keys & helpers ---------- */
const RECENT_KEY = 'nsn_recent';
const BM_KEY = 'nsn_bookmarks';

const $  = (s, root=document)=>root.querySelector(s);
const $$ = (s, root=document)=>[...root.querySelectorAll(s)];

/* ---------- Personalization in header ---------- */
function paintHeaderProfile(){
  const nm = sessionStorage.getItem('nsn_name') || '';
  const tp = sessionStorage.getItem('nsn_type') || '';
  const who = (nm || tp) ? `Hi ${nm ? nm : ''}${nm && tp ? ' • ' : ''}${tp ? tp[0].toUpperCase()+tp.slice(1) : ''}` : '';
  const label = tp ? `Tailored for: ${tp}` : '';
  const helloEl = $('#helloUser');
  const activeEl = $('#activeProfile');
  if (helloEl) helloEl.textContent = who;
  if (activeEl) activeEl.textContent = label;
}

/* ---------- Recent & Bookmarks (shared across pages) ---------- */
function pushRecent(label, href='#'){
  const arr = JSON.parse(localStorage.getItem(RECENT_KEY) || '[]');
  const filtered = arr.filter(x=>x.label!==label);
  filtered.unshift({label, href, ts: Date.now()});
  localStorage.setItem(RECENT_KEY, JSON.stringify(filtered.slice(0,8)));
  paintRecent();
}
function paintRecent(){
  const el = $('#recentList');
  if (!el) return;
  const arr = JSON.parse(localStorage.getItem(RECENT_KEY) || '[]');
  el.innerHTML = arr.length ? arr.map(x=>`<li>${x.label}</li>`).join('') : '<li class="text-muted">Nothing yet.</li>';
}

function getBookmarks(){ try { return JSON.parse(localStorage.getItem(BM_KEY) || '[]'); } catch { return []; } }
function isBookmarked(id){ return getBookmarks().some(x=>x.id===id); }
function toggleBookmark(entry){
  const list = getBookmarks();
  const idx = list.findIndex(x=>x.id===entry.id);
  if(idx>=0) list.splice(idx,1);
  else list.unshift({id:entry.id, href:entry.href||'#', label:entry.label});
  localStorage.setItem(BM_KEY, JSON.stringify(list.slice(0,100)));
  paintBookmarks();
}
function paintBookmarks(){
  const el = $('#bookmarkList');
  if (!el) return;
  const list = getBookmarks();
  el.innerHTML = list.length ? list.map(x=>`<li><i class="bi bi-heart text-danger me-1"></i>${x.label}</li>`).join('') : '<li class="text-muted">No bookmarks yet.</li>';
}
function exportBookmarks(){
  const list = getBookmarks(); if(!list.length){ alert('No bookmarks to export.'); return; }
  const lines = list.map((x,i)=> `${i+1}. ${x.label}`);
  const blob = new Blob([lines.join('\n')], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'Bookmarks.txt'; a.click(); URL.revokeObjectURL(url);
}
function clearBookmarks(){ localStorage.removeItem(BM_KEY); paintBookmarks(); }

/* ---------- Loaders (JSON) ---------- */
async function loadJSON(url){
  const r = await fetch(url, {cache:'no-store'});
  if(!r.ok) throw new Error(`Failed to load ${url}: ${r.status}`);
  return r.json();
}

/** Expand quiz aliases like {"use":"technology"} */
function expandQuizAliases(quiz){
  const out = JSON.parse(JSON.stringify(quiz)); // deep clone
  for (const [k,v] of Object.entries(out)){
    if (v && typeof v === 'object' && 'use' in v){
      const ref = v.use;
      if (!out[ref] || !out[ref].questions) {
        throw new Error(`quiz.json: category "${k}" references missing "${ref}"`);
      }
      out[k] = out[ref];
    }
  }
  return out;
}

/* ---------- Data containers ---------- */
let CAREERS = [];   // from data/careers.json
let QUIZ_DATA = {}; // from data/quiz.json (expanded)

/* ---------- Stream <-> Industry normalization ---------- */
/* The quiz streams are lowercase: technology, business, design, healthcare, engineering
   Careers use Industry with capitalized names: Technology, Business, Design, Healthcare, Engineering */
const STREAM_TO_INDUSTRY = {
  technology: 'Technology',
  business: 'Business',
  design: 'Design',
  healthcare: 'Healthcare',
  engineering: 'Engineering'
};

/* ---------- State ---------- */
const state = {
  interest:null,         // selected quiz category key (e.g. 'technology')
  idx:0,                 // current question index
  answers:[],            // choice index per question
  scores:{technology:0,business:0,design:0,healthcare:0,engineering:0}
};

/* ---------- Quiz flow ---------- */
function startQuiz(interest){
  state.interest = interest;
  state.idx = 0;

  const pack = QUIZ_DATA[interest];
  if (!pack || !Array.isArray(pack.questions)) {
    alert('Quiz content unavailable for this interest.');
    return;
  }

  state.answers = Array(pack.total).fill(null);
  state.scores = {technology:0,business:0,design:0,healthcare:0,engineering:0};

  $('#setup')?.classList.add('hidden');
  $('#quizPanel')?.classList.remove('hidden');
  $('#results')?.classList.add('hidden');

  if($('#qTotal')) $('#qTotal').textContent = pack.total;
  const active = $('#activeProfile');
  if (active) active.textContent = `Interest focus: ${interest[0].toUpperCase()+interest.slice(1)}`;

  renderQuestion();
  pushRecent('Started Interest Quiz');
}

function renderQuestion(){
  const pack = QUIZ_DATA[state.interest];
  const q = pack.questions[state.idx];

  if($('#qIndex')) $('#qIndex').textContent = state.idx + 1;
  if($('#qText'))  $('#qText').textContent  = q.q;

  const pct = Math.round((state.idx) / pack.total * 100);
  const bar = $('#progressBar'); if (bar) bar.style.width = pct + '%';

  const wrap = $('#choices'); if (!wrap) return;
  wrap.innerHTML = '';
  q.choices.forEach((c, i)=>{
    const d = document.createElement('label'); d.className = 'choice';
    if(state.answers[state.idx] === i) d.classList.add('active');
    d.innerHTML = `<input type="radio" name="choice" value="${i}"> ${c.t}`;
    d.addEventListener('click', ()=>{
      state.answers[state.idx] = i;
      $$('.choice').forEach(x=>x.classList.remove('active'));
      d.classList.add('active');
      const btnReview = $('#btnReview');
      if (btnReview) btnReview.disabled = !state.answers.some(a=>a!==null);
    });
    wrap.appendChild(d);
  });

  const btnPrev = $('#btnPrev');
  const btnNext = $('#btnNext');
  if (btnPrev) btnPrev.disabled = state.idx === 0;
  if (btnNext) btnNext.textContent = (state.idx === pack.total - 1) ? 'Finish' : 'Next';
}

function applyScores(){
  state.scores = {technology:0,business:0,design:0,healthcare:0,engineering:0};
  const pack = QUIZ_DATA[state.interest];
  state.answers.forEach((ans, i)=>{
    if(ans===null) return;
    const weights = pack.questions[i].choices[ans].s;
    for(const k in weights) state.scores[k] += weights[k];
  });
}

function toRanked(obj){
  return Object.entries(obj).sort((a,b)=> b[1]-a[1]).map(([stream,score])=>({stream,score}));
}

/* Build recommendation list from careers.json using top streams */
function showResults(){
  applyScores();
  const ranked = toRanked(state.scores).filter(x=>x.score>0);

  $('#quizPanel')?.classList.add('hidden');
  $('#results')?.classList.remove('hidden');

  // Streams badges
  const sb = $('#streamBadges');
  if (sb){
    sb.innerHTML = ranked.length
      ? ranked.slice(0,3).map(x=>`<span class="badge text-bg-primary">${x.stream} • ${x.score}</span>`).join(' ')
      : '<span class="text-muted small">No signals yet — try retaking.</span>';
  }

  // Careers: match by Industry from top 2–3 streams, then dedupe & take up to 6
  const topStreams = ranked.slice(0,3).map(x=>x.stream);
  const industries = topStreams.map(s => STREAM_TO_INDUSTRY[s]).filter(Boolean);
  const matches = CAREERS.filter(c => industries.includes((c.industry||'').trim()));
  const seen = new Set(); const unique = [];
  for(const c of matches){
    if(seen.has(c.id)) continue;
    seen.add(c.id);
    unique.push(c);
    if(unique.length >= 6) break;
  }

  const grid = $('#careerGrid');
  if (grid){
    grid.innerHTML = unique.length ? unique.map(c=>careerCard(c)).join('')
      : '<div class="col-12"><div class="alert alert-warning mb-0">No career suggestions found. Try another interest.</div></div>';
  }

  bindCareerActions();
  pushRecent('Viewed Quiz Results');
}

function careerCard(c){
  const bmActive = isBookmarked(c.id) ? 'bookmark-active' : '';
  const href = c.href || `careers.html?c=${encodeURIComponent(c.id)}`;
  return `
    <div class="col-12 col-md-6">
      <div class="feature-card p-3 h-100 d-flex align-items-start justify-content-between">
        <div class="d-flex align-items-start gap-3">
          <div class="icon-pill"><i class="bi ${c.icon||'bi-briefcase'}"></i></div>
          <div>
            <div class="small text-uppercase text-muted">${c.industry||''}</div>
            <h6 class="mb-1">${c.title}</h6>
            <a class="small" href="${href}">Open in Career Bank</a>
          </div>
        </div>
        <button class="btn btn-light btn-sm border-0 ${bmActive}" title="Bookmark" data-bm="${c.id}" data-label="${c.title}" data-href="${href}">
          <i class="bi bi-heart-fill"></i>
        </button>
      </div>
    </div>
  `;
}

function bindCareerActions(){
  $$('[data-bm]').forEach(btn=>{
    btn.addEventListener('click', (e)=>{
      e.preventDefault();
      const entry = {
        id: btn.getAttribute('data-bm'),
        label: btn.getAttribute('data-label'),
        href: btn.getAttribute('data-href') || '#'
      };
      toggleBookmark(entry);
      $$(`[data-bm="${entry.id}"]`).forEach(b=>b.classList.toggle('bookmark-active'));
    });
  });
}

/* ---------- Review panel ---------- */
function paintReview(){
  const pack = QUIZ_DATA[state.interest];
  const list = $('#reviewList'); if (!list) return;
  list.innerHTML = '';
  state.answers.forEach((ans,i)=>{
    const li = document.createElement('li');
    const ansText = (ans!==null) ? pack.questions[i].choices[ans].t : '(no answer)';
    li.textContent = `Q${i+1}: ${ansText}`;
    li.className = 'mb-1';
    li.style.cursor='pointer';
    li.addEventListener('click', ()=>{
      state.idx = i; $('#reviewBlock')?.classList.add('hidden'); renderQuestion();
    });
    list.appendChild(li);
  });
}

/* ---------- Export full quiz results ---------- */
function exportResults(){
  const lines = [];
  lines.push('NextStep Navigator — Interest Quiz Results');
  lines.push(`Focus: ${state.interest}`);
  lines.push('');

  const ranked = toRanked(state.scores);
  lines.push('Streams:');
  ranked.forEach((r,i)=> lines.push(`${i+1}. ${r.stream}: ${r.score}`));
  lines.push('');

  const pack = QUIZ_DATA[state.interest];
  lines.push('Answers:');
  state.answers.forEach((ans,i)=>{
    const txt = ans===null ? '(no answer)' : pack.questions[i].choices[ans].t;
    lines.push(`Q${i+1}. ${pack.questions[i].q}`);
    lines.push(`   → ${txt}`);
  });

  const blob = new Blob([lines.join('\n')], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'Interest_Quiz_Results.txt'; a.click();
  URL.revokeObjectURL(url);
}

/* ---------- Wire UI ---------- */
function wire(){
  // Setup: interest chooser buttons
  $$('[data-interest]').forEach(btn=>{
    btn.addEventListener('click', ()=> startQuiz(btn.getAttribute('data-interest')));
  });

  // Nav
  $('#btnPrev')?.addEventListener('click', ()=>{
    if(state.idx>0){ state.idx--; renderQuestion(); }
  });
  $('#btnNext')?.addEventListener('click', ()=>{
    const pack = QUIZ_DATA[state.interest];
    if(!pack) return;
    if(state.idx < pack.total - 1){
      if(state.answers[state.idx] === null){
        alert('Please select an answer to continue.');
        return;
      }
      state.idx++; renderQuestion();
    } else {
      if(state.answers[state.idx] === null){
        alert('Please select an answer to finish.');
        return;
      }
      showResults();
    }
  });

  // Review
  $('#btnReview')?.addEventListener('click', ()=>{
    paintReview();
    $('#reviewBlock')?.classList.toggle('hidden');
  });

  // Results actions
  $('#btnSave')?.addEventListener('click', ()=>{
    // save all shown recommendations
    $$('[data-bm]').forEach(btn=>{
      toggleBookmark({
        id: btn.getAttribute('data-bm'),
        label: btn.getAttribute('data-label'),
        href: btn.getAttribute('data-href') || '#'
      });
      btn.classList.add('bookmark-active');
    });
    alert('Saved your recommended careers to Bookmarks.');
  });
  $('#btnExport')?.addEventListener('click', exportResults);
  $('#btnRetake')?.addEventListener('click', ()=>{
    $('#results')?.classList.add('hidden');
    $('#setup')?.classList.remove('hidden');
    window.scrollTo({top:0, behavior:'smooth'});
  });

  // Sidebar bookmarks
  $('#exportBookmarks')?.addEventListener('click', exportBookmarks);
  $('#clearBookmarks')?.addEventListener('click', clearBookmarks);
}

/* ---------- Init: load JSON first, then wire UI ---------- */
async function init(){
  const yearEl = $('#year'); if (yearEl) yearEl.textContent = new Date().getFullYear();
  paintHeaderProfile();
  paintRecent();
  paintBookmarks();

  try {
    // Load careers and quiz data
    CAREERS   = await loadJSON('data/careers.json');
    const raw = await loadJSON('data/quiz.json');
    QUIZ_DATA = expandQuizAliases(raw);
  } catch (e) {
    console.error(e);
    alert(e.message || 'Failed to load data. Please ensure you are running a local server.');
    return;
  }

  // Now that data is ready, wire the UI
  wire();

  // Optional: deep links (e.g., ?mode=ugpg → preselect technology)
  const params = new URLSearchParams(location.search);
  const mode = params.get('mode');
  const map = { ugpg:'technology', pro:'business' };
  if(map[mode]) startQuiz(map[mode]);
}

document.addEventListener('DOMContentLoaded', init);

  </script>
</body>
</html>
