<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Feedback — NextStep Navigator</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"/>
  <!-- Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

  <style>
    :root{
      --brand:#5b7cff; --brand2:#0ea5e9; --ink:#0f172a; --muted:#667085; --ring:#e5e7eb; --card:#fff; --surface:#f8fafc;
    }
    html,body{background:var(--surface); color:var(--ink)}
    a{text-decoration:none}

    .navbar{ background:#fff }
    .brand-dot{ width:10px;height:10px;border-radius:50%;background:linear-gradient(135deg,var(--brand),var(--brand2));box-shadow:0 0 0 3px rgba(14,165,233,.15) }

    .page-head{ background:#fff; border-bottom:1px solid #eef2f7 }
    .lead-muted{ color:var(--muted) }

    .panel{ background:#fff; border:1px solid var(--ring); border-radius:18px }
    .feature-card{ border:1px solid var(--ring); background:var(--card); border-radius:16px; transition:all .25s ease }
    .feature-card:hover{ transform:translateY(-2px); box-shadow:0 12px 26px rgba(16,24,40,.07); border-color:rgba(91,124,255,.4) }

    .muted{ color:var(--muted) }
    .pill{ display:inline-flex; align-items:center; gap:.5rem; padding:.25rem .6rem; border:1px solid var(--ring); border-radius:999px; background:#fff; font-size:.8rem }
    .chip{ display:inline-flex; gap:.4rem; align-items:center; border:1px solid var(--ring); border-radius:999px; padding:.25rem .6rem; background:#fff; font-size:.8rem }
    .required::after{ content:" *"; color:#dc2626 }

    .charbar{ height:8px; border-radius:999px }
    .charbar > div{ height:100%; border-radius:999px; background:linear-gradient(90deg, var(--brand), var(--brand2)) }

    .help{ font-size:.9rem; color:var(--muted) }
    .bookmark-active{ color:#e11d48 !important }
    .hidden{ display:none !important }

    .toast-container{ z-index: 1080 }
    .form-control.is-valid, .form-select.is-valid { border-color:#86efac }
    .form-control.is-invalid, .form-select.is-invalid { border-color:#fca5a5 }
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar navbar-expand-lg border-bottom sticky-top">
    <div class="container py-2">
      <a class="navbar-brand fw-bold d-flex align-items-center gap-2" href="index.html">
        <span class="brand-dot"></span> NextStep <span class="text-primary">Navigator</span>
      </a>
      <div class="ms-auto d-flex align-items-center gap-3">
        <span class="small text-muted" id="helloUser"></span>
        <a class="btn btn-outline-secondary btn-sm" href="index.html"><i class="bi bi-house me-1"></i> Home</a>
      </div>
    </div>
  </nav>

  <!-- HEADER -->
  <header class="page-head py-4">
    <div class="container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">Feedback</li>
        </ol>
      </nav>
      <div class="d-flex flex-column flex-md-row align-items-md-end align-items-start justify-content-between gap-3">
        <div>
          <h1 class="mb-1">Feedback</h1>
          <p class="lead lead-muted mb-0">
            Tell us what you think. This page is a <strong>static prototype</strong> — nothing is sent to any server.
          </p>
        </div>
        <span class="pill"><i class="bi bi-shield-check"></i> Privacy-friendly • No data stored on server</span>
      </div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="py-4">
    <div class="container">
      <div class="row g-4">
        <!-- FORM -->
        <section class="col-lg-8">
          <form id="feedbackForm" class="panel p-3 p-md-4" novalidate>
            <div class="d-flex align-items-center justify-content-between mb-2">
              <h5 class="mb-0">Send Feedback</h5>
              <span class="help">Fields marked * are required</span>
            </div>
            <hr/>

            <div class="row g-3">
              <div class="col-md-6">
                <label for="fbName" class="form-label required">Name</label>
                <input id="fbName" name="name" type="text" class="form-control" placeholder="Your full name" autocomplete="name" required maxlength="80"/>
                <div class="invalid-feedback">Please enter your name.</div>
              </div>

              <div class="col-md-6">
                <label for="fbEmail" class="form-label required">Email</label>
                <input id="fbEmail" name="email" type="email" class="form-control" placeholder="you@example.com" autocomplete="email" required maxlength="120"/>
                <div class="invalid-feedback">Please enter a valid email address.</div>
              </div>

              <div class="col-md-6">
                <label for="fbRole" class="form-label">I am a…</label>
                <select id="fbRole" name="role" class="form-select">
                  <option value="">Choose</option>
                  <option value="student">Student (Grades 8–12)</option>
                  <option value="graduate">Graduate (UG/PG)</option>
                  <option value="professional">Working Professional / Career Changer</option>
                </select>
              </div>

              <div class="col-md-6">
                <label for="fbCategory" class="form-label">Category</label>
                <select id="fbCategory" name="category" class="form-select">
                  <option value="">General</option>
                  <option>Suggestion</option>
                  <option>Bug / Issue</option>
                  <option>Content Request</option>
                  <option>Design / Accessibility</option>
                </select>
              </div>

              <div class="col-12">
                <label for="fbSubject" class="form-label">Subject</label>
                <input id="fbSubject" name="subject" type="text" class="form-control" placeholder="Short summary (optional)" maxlength="120"/>
              </div>

              <div class="col-12">
                <label for="fbMessage" class="form-label required">Message</label>
                <textarea id="fbMessage" name="message" class="form-control" rows="7" placeholder="Write your feedback…" required maxlength="1000"></textarea>
                <div class="d-flex align-items-center justify-content-between mt-1">
                  <div class="invalid-feedback d-block" id="msgError" style="display:none">Please enter your message (10–1000 characters).</div>
                  <div class="small text-muted"><span id="charCount">0</span>/1000</div>
                </div>
                <div class="charbar bg-light mt-2"><div id="charBarFill" style="width:0%"></div></div>
              </div>

              <!-- Honeypot (spam trap, hidden) -->
              <div class="col-12" aria-hidden="true" hidden>
                <label for="fbCompany" class="form-label">Company</label>
                <input id="fbCompany" type="text" class="form-control" autocomplete="organization"/>
              </div>

              <div class="col-12">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="" id="fbConsent" checked/>
                  <label class="form-check-label" for="fbConsent">
                    I understand this is a static demo. My message is only stored in my browser unless I export it.
                  </label>
                </div>
              </div>
            </div>

            <hr/>

            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-primary" type="button" id="btnPreview"><i class="bi bi-eye me-1"></i> Preview</button>
              <button class="btn btn-success" type="submit" id="btnSubmit"><i class="bi bi-send me-1"></i> Submit (Simulated)</button>
              <button class="btn btn-outline-primary" type="button" id="btnSaveDraft"><i class="bi bi-save me-1"></i> Save draft</button>
              <button class="btn btn-outline-secondary" type="button" id="btnLoadDraft"><i class="bi bi-upload me-1"></i> Load draft</button>
              <button class="btn btn-outline-dark" type="button" id="btnExport"><i class="bi bi-download me-1"></i> Export TXT</button>
              <button class="btn btn-outline-danger" type="button" id="btnClear"><i class="bi bi-trash3 me-1"></i> Clear</button>
              <button class="btn btn-light" type="button" id="btnPrint"><i class="bi bi-printer me-1"></i> Print</button>
            </div>

            <div class="small help mt-3">
              We do not send or store your data on a server. “Submit” shows a success toast and adds an entry to “Recently Viewed”. Use “Export” to download your text.
            </div>
          </form>

          <!-- Preview Modal -->
          <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewTitle" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="previewTitle"><i class="bi bi-search"></i> Feedback Preview</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <div class="feature-card p-3">
                    <dl class="row mb-0">
                      <dt class="col-sm-3">Name</dt><dd class="col-sm-9" id="pvName">—</dd>
                      <dt class="col-sm-3">Email</dt><dd class="col-sm-9" id="pvEmail">—</dd>
                      <dt class="col-sm-3">Role</dt><dd class="col-sm-9" id="pvRole">—</dd>
                      <dt class="col-sm-3">Category</dt><dd class="col-sm-9" id="pvCategory">—</dd>
                      <dt class="col-sm-3">Subject</dt><dd class="col-sm-9" id="pvSubject">—</dd>
                      <dt class="col-sm-3">Message</dt><dd class="col-sm-9"><pre class="mb-0" id="pvMessage" style="white-space:pre-wrap"></pre></dd>
                    </dl>
                  </div>
                </div>
                <div class="modal-footer">
                  <button class="btn btn-primary" data-bs-dismiss="modal"><i class="bi bi-pen me-1"></i> Edit</button>
                  <button class="btn btn-outline-dark" id="pvExport"><i class="bi bi-download me-1"></i> Export TXT</button>
                </div>
              </div>
            </div>
          </div>

          <!-- FAQ / Help -->
          <div class="panel p-3 p-md-4 mt-3">
            <h6 class="mb-2">FAQ</h6>
            <div class="accordion" id="faq">
              <div class="accordion-item">
                <h2 class="accordion-header" id="q1">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a1" aria-expanded="false" aria-controls="a1">
                    Is my feedback stored?
                  </button>
                </h2>
                <div id="a1" class="accordion-collapse collapse" aria-labelledby="q1" data-bs-parent="#faq">
                  <div class="accordion-body">
                    No. This is a static site. Your input stays in your browser. You can save a draft (localStorage) or export as a .txt file.
                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="q2">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#a2" aria-expanded="false" aria-controls="a2">
                    Why does Submit say “Simulated”?
                  </button>
                </h2>
                <div id="a2" class="accordion-collapse collapse" aria-labelledby="q2" data-bs-parent="#faq">
                  <div class="accordion-body">
                    Your SRS requires no server storage. “Submit” validates inputs, shows a success toast, and logs to Recently Viewed — no network calls are made.
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- SIDEBAR -->
        <aside class="col-lg-4">
          <div class="panel p-3">
            <h6 class="mb-2">Recently Viewed</h6>
            <ul id="recentList" class="list-unstyled small mb-0">
              <li class="text-muted">Nothing yet.</li>
            </ul>
          </div>

          <div class="panel p-3 mt-3">
            <h6>Your Bookmarks</h6>
            <ul id="bookmarkList" class="list-unstyled small mb-2">
              <li class="text-muted">No bookmarks yet.</li>
            </ul>
            <div class="d-flex gap-2">
              <button class="btn btn-outline-primary btn-sm" id="exportBookmarks"><i class="bi bi-arrow-down-square me-1"></i> Export</button>
              <button class="btn btn-outline-danger btn-sm" id="clearBookmarks"><i class="bi bi-trash3 me-1"></i> Clear</button>
            </div>
          </div>

          <div class="panel p-3 mt-3">
            <h6 class="mb-2">Contact</h6>
            <p class="small mb-2 muted">For general queries, see <a href="contact.html">Contact Us</a>. This page is for UX/content suggestions.</p>
            <div class="d-flex flex-wrap gap-1">
              <span class="chip"><i class="bi bi-tag"></i> Feedback</span>
              <span class="chip"><i class="bi bi-tag"></i> UX</span>
              <span class="chip"><i class="bi bi-tag"></i> Content</span>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="py-4 border-top bg-white">
    <div class="container d-flex flex-column flex-md-row align-items-center justify-content-between gap-2">
      <div class="small text-muted">© <span id="year"></span> NextStep Navigator • Feedback</div>
      <div class="small">
        <a href="about.html" class="me-3">About</a>
        <a href="contact.html">Contact</a>
      </div>
    </div>
  </footer>

  <!-- Toasts -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="okToast" class="toast align-items-center text-bg-success border-0" role="status" aria-live="polite" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body"><i class="bi bi-check2-circle me-2"></i> Feedback submitted (simulated). Nothing was sent to a server.</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
    <div id="draftToast" class="toast align-items-center text-bg-primary border-0 mt-2" role="status" aria-live="polite" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body"><i class="bi bi-save me-2"></i> Draft saved locally.</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <!-- Shared module -->
  <script src="js/nsn-shared.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

  <!-- Page JS -->
  <script>
  (function(){
    "use strict";
    const $  = NSN.utils.$;
    const $$ = NSN.utils.$$;
    const esc = NSN.utils.escapeHTML;

    // Personalize header + sidebars
    function paintHeaderProfile(){
      NSN.paintHeaderProfile('#helloUser', '#activeProfile'); // (active not present here; harmless)
    }

    // Character counter + bar
    function updateCounter(){
      const ta = $('#fbMessage'); const cc = $('#charCount'); const bar = $('#charBarFill');
      if(!ta||!cc||!bar) return;
      const max = ta.getAttribute('maxlength') ? Number(ta.getAttribute('maxlength')) : 1000;
      const len = ta.value.length;
      cc.textContent = len;
      const pct = Math.min(100, Math.round(len/max*100));
      bar.style.width = pct + '%';
      $('#msgError').style.display = (len >= 10 && len <= max) ? 'none' : 'block';
    }

    // Validation helpers
    function validEmail(v){
      return /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/.test(v.trim());
    }
    function validate(){
      const name = $('#fbName'), email = $('#fbEmail'), msg = $('#fbMessage');
      let ok = true;

      // Name
      if(!name.value.trim()){
        name.classList.add('is-invalid'); name.classList.remove('is-valid'); ok = false;
      }else{ name.classList.remove('is-invalid'); name.classList.add('is-valid'); }

      // Email
      if(!validEmail(email.value)){
        email.classList.add('is-invalid'); email.classList.remove('is-valid'); ok = false;
      }else{ email.classList.remove('is-invalid'); email.classList.add('is-valid'); }

      // Message
      const len = msg.value.trim().length;
      if(len < 10 || len > 1000){
        msg.classList.add('is-invalid'); msg.classList.remove('is-valid'); ok = false;
      }else{ msg.classList.remove('is-invalid'); msg.classList.add('is-valid'); }

      // Honeypot (must be empty)
      const hp = $('#fbCompany'); if(hp && hp.value.trim()) ok = false;

      return ok;
    }

    function getPayload(){
      return {
        name: $('#fbName').value.trim(),
        email: $('#fbEmail').value.trim(),
        role: $('#fbRole').value,
        category: $('#fbCategory').value,
        subject: $('#fbSubject').value.trim(),
        message: $('#fbMessage').value.trim(),
        ts: new Date().toISOString()
      };
    }

    function setPayload(p){
      $('#fbName').value = p.name || '';
      $('#fbEmail').value = p.email || '';
      $('#fbRole').value = p.role || '';
      $('#fbCategory').value = p.category || '';
      $('#fbSubject').value = p.subject || '';
      $('#fbMessage').value = p.message || '';
      updateCounter();
    }

    function payloadToTxt(p){
      const lines = [];
      lines.push('NextStep Navigator — Feedback');
      lines.push(`Timestamp: ${new Date(p.ts||Date.now()).toString()}`);
      lines.push('');
      lines.push(`Name: ${p.name||''}`);
      lines.push(`Email: ${p.email||''}`);
      lines.push(`Role: ${p.role||''}`);
      lines.push(`Category: ${p.category||''}`);
      lines.push(`Subject: ${p.subject||''}`);
      lines.push('');
      lines.push('Message:');
      lines.push(p.message||'');
      return lines.join('\n');
    }

    function exportTxt(p, filename='Feedback.txt'){
      const blob = new Blob([payloadToTxt(p)], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = filename; a.click();
      URL.revokeObjectURL(url);
    }

    function clearForm(){
      $('#feedbackForm').reset();
      $$('.is-valid').forEach(n=>n.classList.remove('is-valid'));
      $$('.is-invalid').forEach(n=>n.classList.remove('is-invalid'));
      updateCounter();
    }

    function saveDraft(){
      const p = getPayload();
      localStorage.setItem('nsn_feedback_draft', JSON.stringify(p));
      new bootstrap.Toast($('#draftToast')).show();
    }

    function loadDraft(){
      try{
        const txt = localStorage.getItem('nsn_feedback_draft');
        if(!txt){ alert('No draft found.'); return; }
        const p = JSON.parse(txt);
        setPayload(p);
      }catch{ alert('Could not load draft.'); }
    }

    // Preview modal
    function openPreview(){
      const p = getPayload();
      $('#pvName').textContent = p.name || '—';
      $('#pvEmail').textContent = p.email || '—';
      $('#pvRole').textContent = p.role ? p.role[0].toUpperCase()+p.role.slice(1) : '—';
      $('#pvCategory').textContent = p.category || '—';
      $('#pvSubject').textContent = p.subject || '—';
      $('#pvMessage').textContent = p.message || '';
      const modal = new bootstrap.Modal('#previewModal');
      modal.show();
      $('#pvExport').onclick = ()=> exportTxt(p, 'Feedback_Preview.txt');
    }

    function handleSubmit(e){
      e.preventDefault();
      if(!validate()){
        updateCounter();
        alert('Please fix the highlighted fields.');
        return;
      }
      // Simulated success — no network calls
      new bootstrap.Toast($('#okToast')).show();

      // Recently Viewed entry
      NSN.pushRecent('Submitted Feedback (Simulated)', 'feedback.html', '#recentList');

      // Optional: clear validation states
      $$('.is-valid').forEach(n=>n.classList.remove('is-valid'));
      $$('.is-invalid').forEach(n=>n.classList.remove('is-invalid'));
    }

    function wire(){
      NSN.utils.setYear('#year');
      paintHeaderProfile();

      // Sidebars
      NSN.getRecent(); NSN.paintRecent('#recentList');
      NSN.paintBookmarks('#bookmarkList');
      $('#exportBookmarks')?.addEventListener('click', ()=>NSN.exportBookmarks('Bookmarks.txt'));
      $('#clearBookmarks')?.addEventListener('click', ()=>NSN.clearBookmarks('#bookmarkList'));

      // Form
      $('#fbMessage')?.addEventListener('input', updateCounter);
      $('#fbName')?.addEventListener('blur', validate);
      $('#fbEmail')?.addEventListener('blur', validate);
      $('#fbMessage')?.addEventListener('blur', validate);

      $('#btnPreview')?.addEventListener('click', openPreview);
      $('#btnSubmit')?.addEventListener('click', ()=>$('#feedbackForm').requestSubmit());
      $('#feedbackForm')?.addEventListener('submit', handleSubmit);

      $('#btnSaveDraft')?.addEventListener('click', saveDraft);
      $('#btnLoadDraft')?.addEventListener('click', loadDraft);
      $('#btnExport')?.addEventListener('click', ()=> exportTxt(getPayload(), 'Feedback.txt'));
      $('#btnClear')?.addEventListener('click', clearForm);
      $('#btnPrint')?.addEventListener('click', ()=>window.print());

      // Prefill role from session (nice touch)
      const tp = sessionStorage.getItem('nsn_type') || '';
      if(tp && !$('#fbRole').value) $('#fbRole').value = tp;

      // Initial
      updateCounter();
      NSN.pushRecent('Opened Feedback', 'feedback.html', '#recentList');
    }

    document.addEventListener('DOMContentLoaded', wire);
  })();
  </script>
</body>
</html>
